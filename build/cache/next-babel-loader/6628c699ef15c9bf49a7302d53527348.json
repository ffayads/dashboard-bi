{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport ReactTable from 'react-table-v6';\nimport { Row, Col, Card, CardHeader, CardTitle, CardBody, Button, Table, Input, FormGroup } from 'reactstrap';\nimport { getReports } from '../../Utlis/get';\nimport Modal from '../../components/Modal/modal';\nimport Select from \"react-select\";\nimport ReactHTMLTableToExcel from 'react-html-table-to-excel';\n\nconst content = () => {\n  const [state, setState] = React.useState({\n    data: [],\n    loading: false,\n    filter: \"\",\n    valfilter: \"\",\n    typeValFilter: \"text\",\n    query: []\n  });\n  const [modal, setModal] = React.useState(false);\n  React.useEffect(() => {\n    return () => {\n      setState(_objectSpread({}, state, {\n        data: []\n      }));\n    };\n  }, []);\n  const status = {\n    0: \"INACTIVO\",\n    1: \"ACTIVO\"\n  };\n  const reportS = {\n    0: \"PENDIENTE\",\n    1: \"APROBADO\",\n    2: \"RECHAZADO\",\n    3: \"FINALIZADO\"\n  };\n  const columns = [{\n    Header: 'Tipo de Evento',\n    accessor: 'TypeReport'\n  }, {\n    Header: 'Estado',\n    accessor: 'Status'\n  }, {\n    Header: 'Usuario Visador',\n    accessor: 'AdminUser'\n  }, {\n    Header: props => __jsx(\"center\", null, \"Fecha de evento\"),\n    accessor: \"Date\"\n  }];\n  const optionFilter = [{\n    value: \"@\",\n    label: \"Seleccione\",\n    isDisabled: true\n  }, {\n    value: \"id\",\n    label: \"Numero de registro\",\n    type: \"number\"\n  }, {\n    value: \"type_reports_id\",\n    label: \"Tipo de evento\",\n    type: \"number\"\n  }, {\n    value: \"users_id\",\n    label: \"Usuario\",\n    type: \"number\"\n  }, {\n    value: \"status\",\n    label: \"Estado\",\n    type: \"number\"\n  }, {\n    value: \"admin_users_id\",\n    label: \"Funcionario\",\n    type: \"number\"\n  }, {\n    value: \"date_from\",\n    label: \"Fecha inicial\",\n    type: \"date\"\n  }, {\n    value: \"date_to\",\n    label: \"Fecha final\",\n    type: \"date\"\n  }];\n\n  const getdata = () => {\n    setState(_objectSpread({}, state, {\n      loading: true\n    }));\n    let query = {};\n    state.query.map(elem => {\n      let obj = Object.entries(elem)[0];\n      let type = optionFilter.filter(of => of.value === obj[0])[0];\n      let val = obj[1];\n      if (type.type === \"number\") val = parseInt(val);\n      if (type.type === \"date\") val = val + \" 00:00:00\";\n      query[obj[0]] = val;\n    });\n    getReports(query).then(elem => {\n      if (elem !== undefined && elem.data.reports !== undefined) {\n        let newData = [];\n        elem.data.reports.map(e => {\n          e['Date'] = new Date(e.Time).toLocaleDateString();\n          e['Status'] = reportS[e.Status];\n          newData.push(e);\n        });\n        setState(_objectSpread({}, state, {\n          data: newData,\n          loading: false\n        }));\n        setModal(false);\n      } else {\n        setState(_objectSpread({}, state, {\n          data: [],\n          loading: false\n        }));\n        setModal(false);\n      }\n    });\n  };\n\n  const report = type => {\n    if (type === \"E\") {\n      alert(\"reporte en proceso...\");\n    } else {\n      alert(\"reporte en proceso...\");\n    }\n  };\n\n  const query = () => {\n    let {\n      filter,\n      valfilter\n    } = state;\n\n    if (valfilter !== undefined && valfilter !== \"\") {\n      setState(_objectSpread({}, state, {\n        query: [...state.query, {\n          [filter.value]: valfilter\n        }],\n        valfilter: \"\",\n        typeValFilter: \"text\",\n        filter: {}\n      }));\n    }\n  };\n\n  const queryDelete = index => {\n    let arr = state.query;\n    let i = arr.indexOf(index);\n    arr.splice(i, 1);\n    setState(_objectSpread({}, state, {\n      query: arr\n    }));\n  };\n\n  const getFilter = () => {\n    let trTable = () => {\n      return state.query.map((elem, i) => {\n        let objet = Object.entries(elem)[0];\n        let label = optionFilter.filter(of => of.value === objet[0]);\n        return __jsx(\"tr\", {\n          key: \"tr_\" + i\n        }, __jsx(\"td\", null, label[0].label), __jsx(\"td\", {\n          className: \"text-right\"\n        }, objet[1]), __jsx(\"td\", {\n          className: \"text-right\"\n        }, __jsx(Button, {\n          className: \"btn-round\",\n          color: \"danger\",\n          size: \"sm\",\n          onClick: () => {\n            queryDelete(i);\n          }\n        }, __jsx(\"i\", {\n          className: \"tim-icons icon-simple-remove\"\n        }))));\n      });\n    };\n\n    return __jsx(React.Fragment, null, __jsx(Row, null, __jsx(Col, {\n      xs: 5\n    }, __jsx(Select, {\n      className: \"react-select info\",\n      classNamePrefix: \"react-select\",\n      name: \"fiterSelect\",\n      value: state.filter || \"\",\n      onChange: value => setState(_objectSpread({}, state, {\n        filter: value,\n        typeValFilter: value.type,\n        valfilter: \"\"\n      })),\n      options: optionFilter || \"\",\n      placeholder: \"Filtrar por ...\"\n    })), __jsx(Col, {\n      xs: 3\n    }, __jsx(FormGroup, {\n      className: \"has-info\"\n    }, __jsx(Input, {\n      className: \"info\",\n      type: state.typeValFilter,\n      placeholder: \"Valor\",\n      value: state.valfilter || \"\",\n      onChange: e => setState(_objectSpread({}, state, {\n        valfilter: e.target.value\n      }))\n    }))), __jsx(Col, {\n      xs: 3\n    }, __jsx(Button, {\n      className: \"btn-round\",\n      color: \"info\",\n      size: \"sm\",\n      onClick: () => {\n        query();\n      }\n    }, __jsx(\"i\", {\n      className: \"tim-icons icon-simple-add\"\n    }), \" Agregar\")), __jsx(\"hr\", null), __jsx(Col, {\n      xs: 12\n    }, __jsx(Table, {\n      responsive: true\n    }, __jsx(\"thead\", null, __jsx(\"tr\", null, __jsx(\"th\", null, \"Filtro\"), __jsx(\"th\", {\n      className: \"text-right\"\n    }, \"Valor\"), __jsx(\"th\", {\n      className: \"text-right\"\n    }))), __jsx(\"tbody\", null, trTable()))), __jsx(Col, {\n      xs: 12\n    }, __jsx(\"center\", null, __jsx(Button, {\n      className: \"btn-round\",\n      color: \"success\",\n      size: \"lg\",\n      onClick: () => {\n        getdata();\n      }\n    }, __jsx(\"i\", {\n      className: \"tim-icons icon-send\"\n    }), \" Aplicar\")))));\n  };\n\n  const getTable = () => {\n    return __jsx(Table, {\n      id: \"excel\"\n    }, __jsx(\"thead\", {\n      key: \"report_head\"\n    }, __jsx(\"tr\", {\n      key: \"header\"\n    }, __jsx(\"th\", null, \"Tipo de Evento\"), __jsx(\"th\", null, \"Estado\"), __jsx(\"th\", null, \"Usuario visador\"), __jsx(\"th\", null, \"Fecha de evento\"))), __jsx(\"tbody\", {\n      key: \"report_body\"\n    }, state.data.map((elem, i) => {\n      return __jsx(\"tr\", {\n        key: \"body_tr_\" + i\n      }, columns.map((header, m) => {\n        return __jsx(\"td\", {\n          key: \"body_td_\" + i + m\n        }, elem[header.accessor]);\n      }));\n    })));\n  };\n\n  return __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: \"content\"\n  }, __jsx(Row, null, __jsx(Col, {\n    xs: 12,\n    md: 12\n  }, __jsx(Card, null, __jsx(CardHeader, null, __jsx(Row, null, __jsx(Col, {\n    xs: 3\n  }, __jsx(CardTitle, {\n    tag: \"h3\"\n  }, \"Consulta de sistema\")), __jsx(Col, {\n    xs: 9,\n    className: \"text-right\"\n  }, __jsx(ReactHTMLTableToExcel, {\n    table: \"excel\",\n    filename: \"Report\",\n    sheet: \"page\",\n    className: \"btn-round btn btn-success btn-sm\",\n    buttonText: \"Excel\"\n  }), __jsx(Button, {\n    className: \"btn-round\",\n    color: \"danger\",\n    size: \"sm\",\n    onClick: () => {\n      report(\"P\");\n    },\n    disabled: true\n  }, __jsx(\"i\", {\n    className: \"fa fa-user\"\n  }), \"Pdf\"), __jsx(Button, {\n    className: \"btn-round\",\n    color: \"info\",\n    size: \"sm\",\n    onClick: () => {\n      setModal(true);\n    }\n  }, __jsx(\"i\", {\n    className: \"fa fa-user\"\n  }), \"Filtrar\")))), __jsx(CardBody, null, __jsx(ReactTable, {\n    columns: columns,\n    data: state.data,\n    loading: state.loading,\n    defaultPageSize: 10,\n    sortable: false,\n    resizable: false,\n    className: \"-striped -highlight\",\n    onFetchData: (state, instance) => getdata(state)\n  }))))), __jsx(Modal, {\n    modal: modal,\n    setModal: setModal,\n    title: \"Filtrar\",\n    size: \"lg\"\n  }, getFilter())), __jsx(\"div\", {\n    style: {\n      display: \"none\"\n    }\n  }, getTable()));\n};\n\nexport default content;","map":null,"metadata":{},"sourceType":"module"}